---
import Button from '@components/Shared/Button.astro'
import Container from '@components/Shared/Container.astro'
import { Picture } from 'astro:assets'

const { isLoggedIn, displayName, photoURL } = Astro.locals

const photoURL2 =
  photoURL && photoURL.trim() !== ''
    ? photoURL
    : 'https://api.dicebear.com/7.x/adventurer/svg?seed=Neider'
---

<div class="border-b border-gray-500/30 animate-fade-in-up">
  <header class="relative z-50 py-4 px-8 max-w-5xl mx-auto">
    <div class="flex justify-between items-center">
      <!-- Logo -->
      <img
        src="/systems.svg"
        alt="Logo Principal"
        class="size-10 hidden sm:block"
      />

      <!-- Desktop Navigation -->
      <nav class="hidden sm:block">
        <ul class="flex flex-row justify-between items-center gap-5">
          <li>
            <a
              href="/"
              class="py-2 px-4 hover:bg-gray-700/30 rounded-lg transition-colors"
              >Inicio</a
            >
          </li>
          <li>
            <a
              href="/post/blogTecnicoSistemas"
              class="py-2 px-4 hover:bg-gray-700/30 rounded-lg transition-colors"
              >Blog</a
            >
          </li>
          <li>
            {
              isLoggedIn && (
                <a
                  href="/loginEstudiante"
                  class="py-2 px-4 hover:bg-gray-700/30 rounded-lg transition-colors"
                >
                  Perfil
                </a>
              )
            }
          </li>
          <li>
            {
              isLoggedIn && (
                <a
                  href="/recursos"
                  class="py-2 px-4 hover:bg-gray-700/30 rounded-lg transition-colors"
                >
                  Recursos
                </a>
              )
            }
          </li>
        </ul>
      </nav>

      <!-- User Profile / Login Button -->
      <div class="sm:block">
        {
          isLoggedIn ? (
            <Picture
              transition:name={`image-${displayName}`}
              src={photoURL2}
              alt={'Logo Principal'}
              class={'size-12 rounded-full'}
              inferSize
            />
          ) : (
            <Button href="/inicioSesion"> Ingresar </Button>
          )
        }
      </div>

      <!-- Mobile Menu Toggle -->
      <div class="flex sm:hidden menu_toggle">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>

    <!-- Mobile Navigation Menu -->
    <nav class="mobile_menu">
      <ul class="flex flex-col justify-evenly items-center gap-1 pt-6">
        <li>
          <a
            href="/"
            class="block py-2 px-4 hover:bg-gray-700/30 rounded-lg transition-colors"
            >Inicio</a
          >
        </li>
        <li>
          <a
            href="/post/blogTecnicoSistemas"
            class="block py-2 px-4 hover:bg-gray-700/30 rounded-lg transition-colors"
            >Blog</a
          >
        </li>
        {
          isLoggedIn && (
            <>
              <li>
                <a
                  href="/loginEstudiante"
                  class="block py-2 px-4 hover:bg-gray-700/30 rounded-lg transition-colors"
                >
                  Perfil
                </a>
              </li>
              <li>
                <a
                  href="/recursos"
                  class="block py-2 px-4 hover:bg-gray-700/30 rounded-lg transition-colors"
                >
                  Recursos
                </a>
              </li>
            </>
          )
        }
      </ul>
    </nav>
  </header>
</div>

<style>
  .menu_toggle {
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 7px;
    cursor: pointer;
    padding: 8px;
  }

  .line {
    position: relative;
    width: 35px;
    height: 3px;
    background-color: #cdd7f7;
    border-radius: 10px;
    transition: all 0.3s ease;
  }

  .line:nth-child(1) {
    top: 0;
    transform: rotate(0);
    opacity: 1;
    visibility: visible;
  }

  .line:nth-child(3) {
    top: 0;
    transform: rotate(0);
  }

  .menu_toggle.active .line:nth-child(1) {
    top: 10px;
    transform: rotate(45deg);
  }

  .menu_toggle.active .line:nth-child(2) {
    opacity: 0;
    visibility: hidden;
  }

  .menu_toggle.active .line:nth-child(3) {
    top: -10px;
    transform: rotate(-45deg);
  }

  /* Mobile Menu Styles */
  .mobile_menu {
    display: none;
    overflow: hidden;
    max-height: 0;
    transform: translateY(-250px);
    transition:
      max-height 0.3s ease,
      transform 0.3s ease,
      opacity 0.3s ease;
  }

  .mobile_menu.active {
    display: block;
    max-height: 500px;
    opacity: 1;
    transform: translateY(0);
  }

  @media (width >= 640px) {
    .mobile_menu {
      max-height: 500px;
      opacity: 1;
      transform: translateY(0);
    }
    .mobile_menu.active {
      display: none;
    }
  }

  .mobile_menu li {
    animation: slideInItem 0.4s ease forwards;
    opacity: 0;
  }
  @keyframes slideInItem {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
</style>

<script>
  document.addEventListener('astro:page-load', () => {
    const menu_toggle = document.querySelector('.menu_toggle') as HTMLDivElement
    const mobile_menu = document.querySelector('.mobile_menu') as HTMLElement

    if (menu_toggle && mobile_menu) {
      menu_toggle.addEventListener('click', () => {
        menu_toggle.classList.toggle('active')
        mobile_menu.classList.toggle('active')
      })

      // Close menu when clicking on a link
      const menuLinks = mobile_menu.querySelectorAll('a')
      menuLinks.forEach((link) => {
        link.addEventListener('click', () => {
          menu_toggle.classList.remove('active')
          mobile_menu.classList.remove('active')
        })
      })
    }
  })
</script>
